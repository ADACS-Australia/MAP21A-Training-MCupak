---
title: "Intro to Ansible"
author: "Rebecca Lange"
date: "28/05/2021 updated: `r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    seal: false
    css: [ rutgers, default, default-fonts]
    lib_dir: libs
    nature:
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: ""
    yolo: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<center> <h1> Intro to Ansible </h1> 
![](https://upload.wikimedia.org/wikipedia/commons/0/05/Ansible_Logo.png)
</center>
<center> <h2>*Subtitle*</h2> </center>
<p>
&nbsp;
&nbsp;
</p>

 [**Rebecca Lange**](mailto:rebecca.lange@curtin.edu.au)
 
**Astronomy Data And Computing Services & Curtin Institute for Computation**

```{r, echo=FALSE, results='asis'} 
cat(paste("updated:", format(Sys.time(), '%d/%m/%Y')))
```

???

"color:#2e96c6" - CIC

![cic_logo](img/cic.png)

???

Presenter notes go here

---
class: inverse, center, middle

# Outline

Intro to Ansible 

Concepts

Examples, Demo & Code-Along

Testing & Troubleshooting

Questions & Helpful Resources

---
class: inverse, center, middle

# Introduction to Ansible

---
class: middle

> _Ansible_ is an **agentless automation tool** that you install on a control node. From the control node, _Ansible_ manages machines and other devices remotely (by default, over the **SSH** protocol). <small><sup>1</sup></small>

> It uses a very simple language (**YAML**, in the form of Ansible Playbooks) that allows you to describe your automation jobs in a way that approaches plain English.<small><sup>2</sup></small>

> One of Ansible’s greatest strengths is its ability to **run regular shell commands verbatim**, so you can take existing scripts and commands and work on converting them into idempotent playbooks as time allows.<small><sup>3</sup></small>


.footnote[<small><sup>1</sup> [Installing Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)</br>
<sup>2</sup> [Ansible Overview](https://www.ansible.com/overview/how-ansible-works)</br>
<sup>3</sup> [Ansible for DevOps book](https://www.ansiblefordevops.com/)
</small>]




???

> Ansible is a radically simple **IT automation engine** that automates cloud provisioning, configuration management, application deployment, intra-service orchestration, and many other IT needs.<small><sup>2</sup></small>

> It uses **no agents and no additional custom security infrastructure**, so it's easy to deploy - and most importantly, it uses a very simple language (**YAML**, in the form of Ansible Playbooks) that allow you to describe your automation jobs in a way that approaches plain English.<small><sup>2</sup></small>

<small><sup>2</sup> [Ansible Overview](https://www.ansible.com/overview/how-ansible-works)</small>

---
class: inverse, center, middle

## Ansible use cases


---

.left[![:scale 70%](img/why1.png)]

.right[![:scale 70%](img/why2.png)]

.footnote[<small>Source: [Youtube - What is Ansible - TechWorld with Nana](https://www.youtube.com/watch?v=1id6ERvfozo)</small>]

???

On snowflakes and shell scripts

Many developers and system administrators manage servers by logging into them via SSH, making changes, and logging off. Some of these changes would be documented, some would not. If an admin needed to make the same change to many servers (for example, changing one value in a config file), the admin would manually log into each server and repeatedly make this change.

[from Ansible for DevOps]


---
class: middle

![:scale 150%](https://image.slidesharecdn.com/mdansible-3-4-24-170412173627/95/ansible-5-638.jpg?cb=1492018678)

???

**Provisioning** - make sure a server, VM, computer is set up using required OS and packages

**Configuration Management** - check package/OS/application status and run required updates

**Application Deployment** - configure target VM/server/computer and copy required files/software, and check deployement success.

**Continuous Deployment** - combine with a continuous integration (CI) system to deploy a staging env; a production env on succesfully passed tests, check out from version control, CI server or package mirror.

**Security** - configure security details on control node and embed into all manage nodes automatically to investigate and respond to threats across all nodes.

**Orchestration** - manage multiple nodes and make sure front/backend services, databases, storage, etc are configured properly and in the correct order to run your service


See https://www.ansible.com/use-cases

---
class: middle

## How Ansible works

![](https://geekflare.com/wp-content/uploads/2019/06/how-ansible-works-1.png)

---

class: inverse, center, middle

# Concepts

---
class: middle

**Ansible Tower**:It is a web-based solution for managing your organization with a very easy user interface that provides a dashboard with state summaries of all the hosts, allows quick deployments, and monitors all configurations.

**Ansible Galaxy**: a repository for Ansible Roles that are available to drop directly into your Playbooks to streamline your automation projects.

**Control Node**: The machine where Ansible is installed, responsible for running the provisioning on the servers you are managing.

**Managed Node**: The machine(s) on which play are executed.

**Inventory**: A file containing information about the managed servers.

**Playbook**: The entry point for Ansible provisioning, where the automation is defined through tasks using YAML format. Your "instruction manual".

---
class: middle

**Task**: A block that defines a single procedure to be executed, e.g. Install a package.

**Module**: Modules are "tools in the toolkit" and execute code (e.g. python, shell, etc) which gets pushed out to the managed nodes. Ansible has a multitude of built-in modules, but you can also create custom ones.
 
 **Role**: Roles are sets of Ansible defaults, files, tasks, templates, variables, and other Ansible components that work together and are saved in a named directory strucutre.

**Play**: A provisioning executed from start to finish is called a play. In simple words, execution of a playbook is called a play.

**Facts**: Global variables containing information about the system, like network interfaces or operating system.

**Handlers**: Used to trigger service status changes, like restarting or stopping.

???

https://www.edureka.co/blog/what-is-ansible/#why_do_we_need_ansible

https://dzone.com/articles/getting-started-with-ansible-tower-hands-on

https://www.redhat.com/sysadmin/ansible-galaxy-intro

---

# How to write Playbooks and Inventories

Playbooks are written in **YAML**

They execute specified **Tasks** in sequence, invoking **Ansible modules**.

The tasks are run on the **managed nodes** specified in the **inventory**.

Ansible uses **Jinja2 templating** to enable dynamic expressions and access to variables

---
class: middle

## Playbook Example 1

![](example1.png)

???

- the `name` field is human readable comments (optional)
- `host` specifies which host group is targeted, group specified in the inventory
- `vars` can be specified at the beginning of the playbook, on the command line, separate file
  - environment variables -> e.g. bash profile
- `remote_user` idendity which will perfomr the tasks, could be just one or multiple, or different identity for different tasks
  - privilege escalation -> become: true 
- work gets done in `modules` with `key=value` format
- [including and importing](https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse.html#playbooks-reuse), dynamic vs static

---
class: middle

## Playbook Example 2

![:scale 50%](example2.png)

???

- `handlers` are task that are referenced globaly by a unique name
  - only get run when they are `notified`
  - only run after all other plays in a playbook are run -> even if they are called several times they will only be run once at the end

---
class: middle

## YAML syntax tips
.pull-left[
![:scale 150%](example3_1.png)
]
.pull-right[
![:scale 70%](example3_2.png)
]

```{bash eval=FALSE}
ansible-palybook playbook.yml --syntax-check
```

---

## Inventory Example

The inventory file can be in one of many formats, for example INI:

![](host_example.png)

???

- hosts can be grouped -> [group-name]
- you can specify numeric or alphabetical ranges, 
  - leading zeros can be included, 
  - ranges are inclusive
- hosts can be aliased
- you can specify connection type, and user on per-host basis
- if you run on a non standrad ssh port, specify after hostname with colon

---
class: inverse, center, middle

## Testing & Troubleshooting

---

### Linters and syntax checking

---
### Molecule

___
## Parallel infrastructure

---
class: inverse, center, middle

# Examples, Demo & Code-Along

---

## Requirements

**Control Node**
- Python > v3.5, 
  - ansible-core 2.12 and Ansible 5.0.0 will require Python 3.8
- Windows is _not_ supported for the control node
- YAML
- SSH and SFTP

**Managed Node**
- SSH and SFTP
  - if SFTP not available -> switch to SCP
- Python if possible

**Documentation** 
 - https://docs.ansible.com/

---

## Installation
See [documentation](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#) for details

`ansible`
- Includes the Ansible language and runtime plus a range of community curated Collections
- Install the latest release with your OS package manager or with `pip`

`ansible-core`
- Contains the Ansible language, runtime, and a short list of core modules and other plugins
- Install with `pip` or from source from the ansible/ansible GitHub repository (development version)

```{bash, eval=F}
# to install ansible
python -m pip install --user ansible

# to install ansible-core
pip install ansible-core
```

???

check that `~/.local/bin/` is added to the `$PATH`

one can add arg complete

```{bash, eval=F}
python -m pip install argcomplete
sudo activate-global-python-argcomplete
```


---
class: inverse, middle, center

## Example 1


---
class: inverse, center, middle

# Questions & Helpful Resources


---

## Links

**Jeff Geerling's 'Ansible for DevOps':**
- [Ansible for DevOps book](https://www.ansiblefordevops.com/)
- [Ansible 101 on youtube](https://www.youtube.com/playlist?list=PL2_OBreMn7FqZkvMYt6ATmgC0KAGGJNAN)
- [Github repo](https://github.com/geerlingguy/ansible-for-devops) of examples from the book

**Ansible Documentation:**
- [Installation Guide](https://docs.ansible.com/ansible/latest/installation_guide/index.html_) and [Getting Started with Ansible](https://www.ansible.com/resources/get-started)
- [Intro to Playbooks](https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html#) and [Ansible Example Playbooks on GitHub](https://github.com/ansible/ansible-examples)
- [Ansible Glossary](https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html) 

**Other**
- [Molecule](https://molecule.readthedocs.io/en/latest/) and [Testing your Ansible roles with Molecule](https://www.jeffgeerling.com/blog/2018/testing-your-ansible-roles-molecule)
- [Ansible Lint](https://ansible-lint.readthedocs.io/en/latest/)
- [yamllint](https://yamllint.readthedocs.io/en/stable/)

- [What is Ansible](https://www.youtube.com/watch?v=1id6ERvfozo) - TechWorld with Nana
- [The Bullhorn](https://us19.campaign- archive.com/home/?u=56d874e027110e35dea0e03c1&id=d6635f5420) - Ansible’s official newsletter.
- [Ansible Mailing List on Google Groups](https://groups.google.com/forum/#!forum/ansible-project)
- [Ansible Blog](https://www.ansible.com/blog)


