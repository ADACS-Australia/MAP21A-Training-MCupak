---
title: "Intro to Ansible"
author: "Rebecca Lange"
date: "28/05/2021"
output:
  xaringan::moon_reader:
    seal: false
    css: ["default", "rladies", "rladies-fonts"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    yolo: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<center> <h1> Intro to Ansible </h1> </center>
<center> <h2>Subtitle</h2> </center>
<p>
&nbsp;
&nbsp;
</p>

 [**Rebecca Lange**](mailto:rebecca.lange@curtin.edu.au)

<span style="color:#2e96c6">**Astronomy Data And Computing Services**</span>

<span style="color:#2e96c6">**Curtin Institute for Computation**</span>

```{r, echo=F}
print(lubridate::today())
```

![cic_logo](img/cic.png)

???

Presenter notes go here

---
class: inverse, center, middle

# Outline

Intro to Ansible 

Concepts

Examples, Demo & Code-Along

Troubleshooting

Questions & Helpful Resources

---
class: middle

# What is Ansible?

> _Ansible_ is an **agentless automation tool** that you install on a control node. From the control node, _Ansible_ manages machines and other devices remotely (by default, over the SSH protocol). <small><sup>1</sup></small>

> It uses a very simple language (**YAML**, in the form of Ansible Playbooks) that allows you to describe your automation jobs in a way that approaches plain English.<small><sup>2</sup></small>


<small><sup>1</sup> [Installing Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)</small>

<small><sup>2</sup> [Ansible Overview](https://www.ansible.com/overview/how-ansible-works)</small>

???

> Ansible is a radically simple **IT automation engine** that automates cloud provisioning, configuration management, application deployment, intra-service orchestration, and many other IT needs.<small><sup>2</sup></small>

> It uses **no agents and no additional custom security infrastructure**, so it's easy to deploy - and most importantly, it uses a very simple language (**YAML**, in the form of Ansible Playbooks) that allow you to describe your automation jobs in a way that approaches plain English.<small><sup>2</sup></small>

<small><sup>2</sup> [Ansible Overview](https://www.ansible.com/overview/how-ansible-works)</small>

---

## Requirements

**Control Node**
- Python > v3.5, 
  - ansible-core 2.12 and Ansible 5.0.0 will require Python 3.8
- Windows is _not_ supported for the control node
- YAML
- SSH and SFTP

**Managed Node**
- SSH and SFTP
  - if SFTP not available -> switch to SCP
- Python if possible

**Documentation** 
 - https://docs.ansible.com/

---

## Installation

`ansible`
- Includes the Ansible language and runtime plus a range of community curated Collections
- Install the latest release with your OS package manager or with `pip`

`ansible-core`
- Contains the Ansible language, runtime, and a short list of core modules and other plugins
- Install ansible-core (version 2.11 and greater) or ansible-base (version 2.10) with `pip`, or from source from the ansible/ansible GitHub repository(development version)

[Installing with `pip`](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-and-upgrading-ansible-with-pip])
```{python, eval=F}
# to install ansible
python -m pip install --user ansible

# to install ansible-core
pip install ansible-core
```


---

# Concepts

- inventory
- playbook
- Yaml
  - jinja syntax

- become: true -> become root user
- variables
- tasks
- handlers
- environment variables -> e.g. bash profile


---
# Inventory files

---
# Writing Playbooks

--

incremental slide

--

- bullet point

---

# R Code

```{r comment='#'}
# a boring regression
fit = lm(dist ~ 1 + speed, data = cars)
coef(summary(fit))
dojutsu = c('地爆天星', '天照', '加具土命', '神威', '須佐能乎', '無限月読')
grep('天', dojutsu, value = TRUE)
```

---

# R Plots

```{r cars, fig.height=4, dev='svg'}
par(mar = c(4, 4, 1, .1))
plot(cars, pch = 19, col = 'darkgray', las = 1)
abline(fit, lwd = 2)
```

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r}
knitr::kable(head(iris), format = 'html')
```
